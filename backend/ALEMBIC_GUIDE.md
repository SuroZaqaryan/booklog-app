# üîÑ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å Alembic –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

## üìñ –ß—Ç–æ —Ç–∞–∫–æ–µ Alembic?

**Alembic** - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy. –ú–∏–≥—Ä–∞—Ü–∏–∏ - —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –∫–æ–ª–æ–Ω–æ–∫, –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ —Ç.–¥.).

### ü§î –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏?

–ë–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π:
```python
# ‚ùå –ò–∑–º–µ–Ω–∏–ª–∏ –º–æ–¥–µ–ª—å –≤ –∫–æ–¥–µ
class BookModel(Base):
    author = Column(String)  # –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–ª–µ

# ‚ùå –ó–∞–ø—É—Å—Ç–∏–ª–∏ —Å–µ—Ä–≤–µ—Ä
# ‚ùå –ü–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É: "no such column: books.author"
# ‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï –æ–±–Ω–æ–≤–∏–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

–° –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:
```python
# ‚úÖ –ò–∑–º–µ–Ω–∏–ª–∏ –º–æ–¥–µ–ª—å –≤ –∫–æ–¥–µ
# ‚úÖ –°–æ–∑–¥–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é: alembic revision --autogenerate
# ‚úÖ –ü—Ä–∏–º–µ–Ω–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é: alembic upgrade head
# ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞! –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
python -m alembic upgrade head

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–≥—Ä–∞—Ü–∏–π –≤–ø–µ—Ä—ë–¥
python -m alembic upgrade +2

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
python -m alembic upgrade abc123def456
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫)
- –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –∏–∑ Git
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

---

### 2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª—è—Ö
python -m alembic revision --autogenerate -m "add author column to books"

# –° –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º:
# - revision: —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
# - --autogenerate: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
# - -m "–æ–ø–∏—Å–∞–Ω–∏–µ": –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–æ–±–∞–≤–∏–ª–∏/–∏–∑–º–µ–Ω–∏–ª–∏ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª–∏
- –î–æ–±–∞–≤–∏–ª–∏/—É–¥–∞–ª–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É
- –ò–∑–º–µ–Ω–∏–ª–∏ –∏–Ω–¥–µ–∫—Å—ã –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

---

### 3. –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–≤—Ä—É—á–Ω—É—é)

```bash
# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
python -m alembic revision -m "custom data migration"
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π SQL
- –ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—ã
- –ù—É–∂–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é autogenerate –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å

---

### 4. –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
python -m alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python -m alembic downgrade base

# –û—Ç–∫–∞—Ç–∏—Ç—å –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
python -m alembic downgrade abc123def456
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –û—Ç–∫–∞—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö!

---

### 5. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python -m alembic history

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
python -m alembic current

# –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏
python -m alembic history --verbose
```

---

### 6. –û—Ç–º–µ—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é (–±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

```bash
# –û—Ç–º–µ—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
python -m alembic stamp abc123def456

# –û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
python -m alembic stamp head
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é
- –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é –ø–æ—Å–ª–µ –ø—Ä—è–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ë–î

---

## üìù –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è

### –°—Ü–µ–Ω–∞—Ä–∏–π: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `author` –≤ —Ç–∞–±–ª–∏—Ü—É `books`

#### –®–∞–≥ 1: –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å ORM

```python
# app/models/book.py
class BookModel(Base):
    __tablename__ = "books"
    
    id = Column(Integer, primary_key=True)
    name = Column(String, nullable=False)
    genre = Column(String, nullable=True)
    author = Column(String, nullable=True)  # ‚Üê –î–æ–±–∞–≤–∏–ª–∏ —ç—Ç–æ –ø–æ–ª–µ
```

#### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å Pydantic —Å—Ö–µ–º—ã

```python
# app/schemas/book.py
class BookBase(BaseModel):
    name: str
    genre: Optional[str] = None
    author: Optional[str] = None  # ‚Üê –î–æ–±–∞–≤–∏–ª–∏ —ç—Ç–æ –ø–æ–ª–µ
```

#### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
cd backend
python -m alembic revision --autogenerate -m "add author column to books table"
```

**–í—ã–≤–æ–¥:**
```
INFO  [alembic.autogenerate.compare] Detected added column 'books.author'
Generating C:\...\alembic\versions\abc123_add_author_column_to_books_table.py ... done
```

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:

```python
# alembic/versions/abc123_add_author_column_to_books_table.py

def upgrade() -> None:
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è."""
    op.add_column('books', sa.Column('author', sa.String(), nullable=True))

def downgrade() -> None:
    """–û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è."""
    op.drop_column('books', 'author')
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é! –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é.

#### –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
python -m alembic upgrade head
```

**–í—ã–≤–æ–¥:**
```
INFO  [alembic.runtime.migration] Running upgrade ... -> abc123, add author column to books table
```

#### –®–∞–≥ 6: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

```bash
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

–¢–µ–ø–µ—Ä—å API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º! ‚úÖ

---

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É

```python
# 1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å
# app/models/review.py
class ReviewModel(Base):
    __tablename__ = "reviews"
    id = Column(Integer, primary_key=True)
    book_id = Column(Integer, ForeignKey("books.id"))
    text = Column(String)

# 2. –î–æ–±–∞–≤–∏—Ç—å –≤ __init__.py
# app/models/__init__.py
from app.models.review import ReviewModel
__all__ = ["Base", "BookModel", "GenreModel", "ReviewModel"]

# 3. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python -m alembic revision --autogenerate -m "create reviews table"

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å
python -m alembic upgrade head
```

---

### 2. –£–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É

```python
# 1. –£–¥–∞–ª–∏—Ç—å –∏–∑ –º–æ–¥–µ–ª–∏
class BookModel(Base):
    # author = Column(String)  # ‚Üê –£–¥–∞–ª–∏–ª–∏

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python -m alembic revision --autogenerate -m "remove author column from books"

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å
python -m alembic upgrade head
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –≤ –∫–æ–ª–æ–Ω–∫–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!

---

### 3. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É

```python
# SQLite –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢ –ø—Ä—è–º–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ!
# –ù—É–∂–Ω–æ:
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É
# 2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
# 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –∫–æ–ª–æ–Ω–∫—É

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é:
python -m alembic revision -m "rename author to book_author"

# –í —Ñ–∞–π–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
def upgrade():
    # –î–ª—è SQLite –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É
    op.add_column('books', sa.Column('book_author', sa.String()))
    op.execute('UPDATE books SET book_author = author')
    op.drop_column('books', 'author')
```

---

### 4. –î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É

```python
# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é
python -m alembic revision -m "add default genres"

# –í —Ñ–∞–π–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
def upgrade():
    op.execute("""
        INSERT INTO genres (name) VALUES 
        ('Fantasy'),
        ('Science Fiction'),
        ('Mystery')
    """)

def downgrade():
    op.execute("DELETE FROM genres WHERE name IN ('Fantasy', 'Science Fiction', 'Mystery')")
```

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "no such column" –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
```bash
python -m alembic upgrade head
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "duplicate column name"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–ª–æ–Ω–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –µ—ë —Å–Ω–æ–≤–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—Ç–º–µ—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
python -m alembic stamp head
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: SQLite "near ALTER: syntax error"

**–ü—Ä–∏—á–∏–Ω–∞:** SQLite –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ALTER TABLE

**–†–µ—à–µ–Ω–∏–µ:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, —É–±—Ä–∞–≤ –æ–ø–µ—Ä–∞—Ü–∏–∏ `alter_column`

```python
# ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ SQLite
def upgrade():
    op.alter_column('books', 'name', nullable=False)

# ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç - —Ç–æ–ª—å–∫–æ add_column
def upgrade():
    op.add_column('books', sa.Column('author', sa.String()))
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–∏–≥—Ä–∞—Ü–∏–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ç–æ–∫)

**–ü—Ä–∏—á–∏–Ω–∞:** –î–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–∑–¥–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é
python -m alembic history

# 2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤–µ—Ç–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π
python -m alembic merge -m "merge migrations" head1 head2

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å
python -m alembic upgrade head
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î

### –£–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏

```python
# –ß–µ—Ä–µ–∑ Python
import sqlite3
conn = sqlite3.connect('books.db')
cur = conn.cursor()
version = cur.execute("SELECT version_num FROM alembic_version").fetchone()
print(f"Current version: {version[0]}")
```

```bash
# –ß–µ—Ä–µ–∑ Alembic
python -m alembic current
```

---

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã

```python
# check_schema.py
import sqlite3
conn = sqlite3.connect('books.db')
cur = conn.cursor()
schema = cur.execute("PRAGMA table_info(books)").fetchall()
for col in schema:
    print(f"{col[1]} ({col[2]}) - nullable: {not col[3]}")
```

---

## üìö Best Practices

### ‚úÖ DO (–î–µ–ª–∞–π—Ç–µ)

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
   ```bash
   # –ü–æ—Å–ª–µ autogenerate –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ!
   ```

2. **–ü–∏—à–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
   ```bash
   # ‚úÖ –•–æ—Ä–æ—à–æ
   alembic revision --autogenerate -m "add author and isbn fields to books"
   
   # ‚ùå –ü–ª–æ—Ö–æ
   alembic revision --autogenerate -m "update"
   ```

3. **–•—Ä–∞–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Git**
   ```bash
   git add alembic/versions/*.py
   git commit -m "Add migration for author field"
   ```

4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–ø–∏–∏ –ë–î**
   ```bash
   # –°–¥–µ–ª–∞–π—Ç–µ backup –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
   cp books.db books.db.backup
   python -m alembic upgrade head
   ```

5. **–ü–∏—à–∏—Ç–µ downgrade —Ñ—É–Ω–∫—Ü–∏–∏**
   ```python
   # –í—Å–µ–≥–¥–∞ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ downgrade –¥–ª—è –æ—Ç–∫–∞—Ç–∞
   def downgrade():
       op.drop_column('books', 'author')
   ```

---

### ‚ùå DON'T (–ù–µ –¥–µ–ª–∞–π—Ç–µ)

1. **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
   ```bash
   # ‚ùå –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –≤ Git –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ - –Ω–µ —Ç—Ä–æ–≥–∞–π—Ç–µ –µ—ë!
   # ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
   ```

2. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ Base.metadata.create_all()**
   ```python
   # ‚ùå –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ –ù–û–í–´–ï —Ç–∞–±–ª–∏—Ü—ã, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ!
   Base.metadata.create_all()
   ```

3. **–ù–µ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ production –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
   ```bash
   # ‚ùå –°—Ä–∞–∑—É –Ω–∞ production
   # ‚úÖ –°–Ω–∞—á–∞–ª–∞ –Ω–∞ dev/staging
   ```

4. **–ù–µ —É–¥–∞–ª—è–π—Ç–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π**
   ```bash
   # ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–µ –æ—Ç–∫–∞—Ç–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ë–î!
   # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ alembic downgrade
   ```

---

## üìñ –†–µ–∑—é–º–µ

| –î–µ–π—Å—Ç–≤–∏–µ | –ö–æ–º–∞–Ω–¥–∞ |
|----------|---------|
| –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ | `python -m alembic upgrade head` |
| –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—é | `python -m alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ"` |
| –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é | `python -m alembic revision -m "–æ–ø–∏—Å–∞–Ω–∏–µ"` |
| –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é | `python -m alembic downgrade -1` |
| –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ | `python -m alembic downgrade base` |
| –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é | `python -m alembic history` |
| –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é | `python -m alembic current` |
| –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é | `python -m alembic stamp head` |

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Alembic](https://alembic.sqlalchemy.org/)
- [SQLAlchemy ORM Tutorial](https://docs.sqlalchemy.org/en/20/orm/tutorial.html)
- [FastAPI + Alembic Best Practices](https://fastapi.tiangolo.com/tutorial/sql-databases/)

---

**üí° –ü–æ–º–Ω–∏—Ç–µ:** –ú–∏–≥—Ä–∞—Ü–∏–∏ - —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π –¥–ª—è –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –≤—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç–µ —Å—Ö–µ–º—É –ë–î.
