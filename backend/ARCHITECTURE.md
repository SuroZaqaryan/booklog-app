# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Backend

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ alembic/                  # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ versions/            # –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ env.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îÇ
‚îú‚îÄ‚îÄ app/                     # –ì–ª–∞–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ api/                # API Layer (REST endpoints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (dependencies)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/            # API –≤–µ—Ä—Å–∏–∏ 1
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ api.py     # –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ endpoints/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ books.py  # Endpoints –¥–ª—è –∫–Ω–∏–≥
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/              # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (Settings)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/           # ORM –º–æ–¥–µ–ª–∏ (SQLAlchemy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py      # Base –∫–ª–∞—Å—Å –¥–ª—è –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ book.py      # –ú–æ–¥–µ–ª—å Book
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ genre.py     # –ú–æ–¥–µ–ª—å Genre
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/         # Pydantic —Å—Ö–µ–º—ã (DTO)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ book.py     # –°—Ö–µ–º—ã –¥–ª—è –∫–Ω–∏–≥
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ book.py    # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ repositories/  # –†–∞–±–æ—Ç–∞ —Å –ë–î (Data Access Layer)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ book.py   # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –∫–Ω–∏–≥
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/        # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ enums.py # Enums –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ main.py      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ pyproject.toml   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ alembic.ini     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îî‚îÄ‚îÄ README.md       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **Clean Architecture** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏:

### 1. API Layer (`api/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç REST endpoints
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—á–µ—Ä–µ–∑ Pydantic)
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ HTTP –æ—Ç–≤–µ—Ç—ã
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ Service Layer

**–ü—Ä–∏–º–µ—Ä:**
```python
@router.get("", response_model=List[BookPublic])
async def get_books(service: BookService = Depends(get_book_service)):
    return await service.get_all_books()
```

### 2. Service Layer (`services/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
- –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–ï –∑–Ω–∞–µ—Ç –æ HTTP (FastAPI)
- –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å SQLAlchemy –º–æ–¥–µ–ª—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Repository Layer –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

**–ü—Ä–∏–º–µ—Ä:**
```python
class BookService:
    def __init__(self, repository: BookRepository):
        self.repository = repository
    
    async def create_book(self, book_data: BookCreate) -> BookModel:
        return await self.repository.create(book_data.model_dump())
```

### 3. Repository Layer (`repositories/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SQLAlchemy ORM

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å ORM –º–æ–¥–µ–ª—è–º–∏
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```python
class BookRepository:
    def __init__(self, db: AsyncSession):
        self.db = db
    
    async def get_all(self) -> List[BookModel]:
        result = await self.db.execute(select(BookModel))
        return list(result.scalars().all())
```

### 4. Models Layer (`models/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** ORM –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLAlchemy

**–ü—Ä–∞–≤–∏–ª–∞:**
- –¢–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- –ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏

### 5. Schemas Layer (`schemas/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö API
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Pydantic

**–¢–∏–ø—ã —Å—Ö–µ–º:**
- `*Base` - –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
- `*Create` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
- `*Update` - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `*Public` - –¥–ª—è –æ—Ç–¥–∞—á–∏ –∫–ª–∏–µ–Ω—Ç—É

### 6. Core (`core/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- `config.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `database.py` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Request Flow)

```
1. HTTP Request
   ‚Üì
2. API Endpoint (api/v1/endpoints/books.py)
   ‚Üì
3. Service (services/book.py)
   ‚Üì
4. Repository (repositories/book.py)
   ‚Üì
5. Database (—á–µ—Ä–µ–∑ SQLAlchemy)
   ‚Üì
6. ORM Model (models/book.py)
   ‚Üì
7. Pydantic Schema (schemas/book.py)
   ‚Üì
8. HTTP Response
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã SOLID

### Single Responsibility Principle (SRP)
–ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:
- **Repository** - —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **Service** - —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **Endpoint** - —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP

### Open/Closed Principle (OCP)
–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞:
- –ù–æ–≤—ã–µ endpoints –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö

### Dependency Inversion Principle (DIP)
–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö:
- Service –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ Repository
- API –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ Service

## üì¶ Dependency Injection

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º FastAPI `Depends()`:

```python
def get_book_service(db: AsyncSession = Depends(get_db)) -> BookService:
    repository = BookRepository(db)
    return BookService(repository)

@router.get("")
async def get_books(service: BookService = Depends(get_book_service)):
    return await service.get_all_books()
```

## üîß –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ endpoint

1. **–°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—ã** –≤ `schemas/`
2. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ Repository** –≤ `repositories/`
3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ Service** –≤ `services/`
4. **–°–æ–∑–¥–∞—Ç—å endpoint** –≤ `api/v1/endpoints/`
5. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å router** –≤ `api/v1/api.py`

### –ü—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"

```python
# 1. schemas/book.py
class BookAddToFavorites(BaseModel):
    book_id: int

# 2. repositories/book.py
async def add_to_favorites(self, book_id: int, user_id: int):
    # SQL –∑–∞–ø—Ä–æ—Å

# 3. services/book.py
async def add_to_favorites(self, book_id: int, user_id: int):
    await self.repository.add_to_favorites(book_id, user_id)

# 4. api/v1/endpoints/books.py
@router.post("/{book_id}/favorites")
async def add_to_favorites(
    book_id: int,
    service: BookService = Depends(get_book_service)
):
    await service.add_to_favorites(book_id)
    return {"status": "ok"}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–∞–∂–¥—ã–π —Å–ª–æ–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ:

- **Repository tests** - —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î (–∏–ª–∏ mock)
- **Service tests** - —Å mock Repository
- **API tests** - —Å mock Service –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Å–ª–æ–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
3. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –∫–æ–¥ –ª–æ–≥–∏—á–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω
4. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** - —Å–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö endpoints
5. **Maintainability** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏

## üìö Best Practices

1. **–ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ —Å–ª–æ–∏** - API –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ë–î –Ω–∞–ø—Ä—è–º—É—é
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ type hints** - –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ docstrings
4. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pydantic —Å—Ö–µ–º—ã
5. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ try/except –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
6. **–õ–æ–≥–∏—Ä—É–π—Ç–µ** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ logging –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
7. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π—Ç–µ API** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/v1/`, `/api/v2/` –∏ —Ç.–¥.
